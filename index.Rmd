--- 
title: "Cadastro Nacional de Condenações Cíveis por Ato de Improbidade Administrativa e Inelegibilidade"
author: "Associação Brasileira de Jurimetria"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib]
biblio-style: apalike
link-citations: yes
description: "Análise do Cadastro Nacional de Condenações Cíveis por Ato de Improbidade Administrativa e Inelegibilidade."
---

# Preâmbulo

Este é um relatório escrito em **Markdown** descrevendo um estudo realizado pela Associação Brasileira de Jurimetria (ABJ) para o Instituto Não Aceito Corrupção. O estudo em questão teve a finalidade de compreender o crime de improbidade admnistrativa analisando os admnistradores públicos que constam no Cadastro Nacional de Condenações Cíveis por Ato de Improbidade Administrativa e Inelegibilidade (CNC) do Conselho Nacional de Justiça (CNJ).

Para compilar este relatório, você precisará da versão de desenvolvimento do pacote bookdown disponível no Github do rstudio:

```{r, eval=FALSE}
devtools::install_github("rstudio/bookdown")
```

Cada arquivo Rmd contém um e apenas um capítulo, e cada capítulo é definido pelo primeiro nível de cabeçalho #.

Para compilar este documento em PDF, você precisará utilizar XeLaTeX.

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(stringr)
library(lubridate)
library(janitor)
library(cnc)
library(tpur)
library(magrittr)
library(tidyverse)

data(tidy_cnc, package = 'cnc')

tabela_assuntos <- download_table("assunto","estadual","primeiro grau") %>% 
  build_table()

assuntos_penais <- tabela_assuntos %>%
  filter(str_detect(n1, regex("penal", ignore_case = T))) %>% 
  select(contains("n")) %>% 
  gather(nivel, assunto) %>% 
  distinct(assunto, .keep_all = T) %>% 
  with(assunto)

assuntos <- tidy_cnc %>% 
  select(dplyr::contains("assunto_nm")) %>% 
  mutate(id = 1:n()) %>% 
  gather(rank, assunto, -id) %>% 
  filter(!is.na(assunto)) %>% 
  mutate(penal_lgl = assunto %in% assuntos_penais)

assuntos_penal_any <- assuntos %>% 
  group_by(id) %>% 
  summarise(assunto_penal_any = any(penal_lgl))

assuntos_penal_all <- assuntos %>% 
  group_by(id) %>% 
  summarise(assunto_penal_all = all(penal_lgl))
  
tidy_cnc %<>%
  mutate(id = 1:n()) %>% 
  left_join(assuntos_penal_all) %>% 
  left_join(assuntos_penal_any)
```


